---
title: 'LSBéšå†™'
description: 'åšå®¢ä¸­æ–‡æµ‹è¯•ç®€ä»‹æè¿°'
pubDate: 2025-09-28
author: 'Shenlin'
cover: assets/wallhaven-6loz9w.png
recommend: true
tags: ['CTF', 'Steganography']
---

è¿™ä¸ªé¡µé¢æ˜¯ä¸€ä¸ªä¸­æ–‡æµ‹è¯•ã€‚

# LSBéšå†™

# LSBéšå†™æŠ€æœ¯æ¦‚è¿°

LSBï¼ˆLeast Significant Bitï¼Œæœ€ä½æœ‰æ•ˆä½ï¼‰éšå†™æ˜¯ä¸€ç§æ•°å­—éšå†™æœ¯æŠ€æœ¯ï¼Œå®ƒé€šè¿‡ä¿®æ”¹æ•°å­—åª’ä½“ï¼ˆå¦‚å›¾åƒã€éŸ³é¢‘æˆ–è§†é¢‘ï¼‰ä¸­æ•°æ®çš„æœ€ä½æœ‰æ•ˆä½æ¥éšè—ä¿¡æ¯ã€‚ç”±äºäººç±»æ„Ÿå®˜é€šå¸¸æ— æ³•å¯Ÿè§‰è¿™äº›å¾®å°çš„å˜åŒ–ï¼ŒLSBéšå†™å¯ä»¥åœ¨ä¸å¼•èµ·æ³¨æ„çš„æƒ…å†µä¸‹ä¼ é€’ç§˜å¯†ä¿¡æ¯ã€‚

## LSBéšå†™æŠ€æœ¯åŸç†

åœ¨æ•°å­—ç³»ç»Ÿä¸­ï¼Œæ•°æ®ä»¥äºŒè¿›åˆ¶å½¢å¼å­˜å‚¨ã€‚ä»¥å›¾åƒä¸ºä¾‹ï¼Œæ¯ä¸ªåƒç´ çš„é¢œè‰²ç”±RGBä¸‰ä¸ªé€šé“ç»„æˆï¼Œæ¯ä¸ªé€šé“é€šå¸¸ç”¨8ä½ï¼ˆ1å­—èŠ‚ï¼‰è¡¨ç¤ºï¼ŒèŒƒå›´ä»0åˆ°255ã€‚

LSBéšå†™åˆ©ç”¨äº†è¿™æ ·ä¸€ä¸ªäº‹å®ï¼šä¿®æ”¹è¿™äº›8ä½ä¸­çš„æœ€ä½ä½ï¼ˆç¬¬1ä½ï¼‰å¯¹å›¾åƒçš„è§†è§‰æ•ˆæœå½±å“æå°ã€‚ä¾‹å¦‚ï¼Œå°†åƒç´ å€¼ä»200ï¼ˆ11001000ï¼‰æ”¹ä¸º201ï¼ˆ11001001ï¼‰å‡ ä¹ä¸ä¼šäº§ç”Ÿè‚‰çœ¼å¯è§çš„å·®å¼‚ã€‚

é€šè¿‡ç³»ç»Ÿåœ°ä¿®æ”¹å›¾åƒä¸­æ‰€æœ‰åƒç´ çš„LSBï¼Œæˆ‘ä»¬å¯ä»¥åµŒå…¥å¤§é‡ä¿¡æ¯è€Œä¸ä¼šæ˜æ˜¾æ”¹å˜å›¾åƒçš„å¤–è§‚ã€‚

## LSB åŠ å¯†ï¼ˆéšè—ï¼‰æµç¨‹å›¾

1. å¼€å§‹
   - æ˜ç¡®è½½ä½“ç±»å‹ä¸å®¹é‡éœ€æ±‚ï¼ˆå›¾åƒåˆ†è¾¨ç‡ã€é€šé“æ•°ã€å¯ç”¨æ¯”ç‰¹æ•°ï¼‰
2. è¯»å–è¾“å…¥
   - è¯»å–è½½ä½“å›¾åƒï¼ˆRGB æˆ– RGBAï¼‰
   - è¯»å–å¾…éšè—æ•°æ®ï¼ˆæ–‡æœ¬æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰
3. é¢„å¤„ç†æ•°æ®ï¼ˆå¯é€‰ä½†æ¨èï¼‰
   - å‹ç¼©æ•°æ®ä»¥æé«˜æœ‰æ•ˆè½½è·ç‡
   - å¯¹æ•°æ®è¿›è¡Œå¯¹ç§°åŠ å¯†ï¼ˆå¦‚ AES/SM4ï¼‰ï¼Œå¹¶éšæœºåŒ–å­—èŠ‚åˆ†å¸ƒ
   - æ·»åŠ å®Œæ•´æ€§æ ¡éªŒï¼ˆå¦‚ CRC32 æˆ– HMACï¼‰
4. åºåˆ—åŒ–ä¸ºæ¯”ç‰¹æµ
   - å°†æ•°æ®é•¿åº¦å†™å…¥å¤´éƒ¨ï¼ˆä¾‹å¦‚ 32 ä½ï¼‰
   - å°†æ­£æ–‡æ•°æ®æŒ‰å­—èŠ‚å±•å¼€ä¸º bit åºåˆ—
5. å®¹é‡æ£€æŸ¥
   - è®¡ç®—æœ€å¤§å¯åµŒå…¥ä½æ•° = å¯ç”¨äºåµŒå…¥çš„åƒç´ æ•° Ã— æ¯åƒç´ ä½¿ç”¨çš„é€šé“æ•°
   - è‹¥ æ•°æ®ä½æ•° > æœ€å¤§å¯åµŒå…¥ä½æ•° â†’ æŠ¥é”™å¹¶ç»ˆæ­¢
6. åµŒå…¥ç­–ç•¥é€‰æ‹©
   - é¡ºåºåµŒå…¥ï¼šæŒ‰åƒç´ ä¸é€šé“é¡ºåºå†™å…¥ LSB
   - ä¼ªéšæœºåµŒå…¥ï¼ˆæ¨èï¼‰ï¼šç”¨å¯†é’¥é©±åŠ¨ PRNG ç”Ÿæˆå†™å…¥ç´¢å¼•åºåˆ—
7. éå†å†™å…¥
   - å¯¹æ¯ä¸ªé€‰ä¸­çš„åƒç´ é€šé“ï¼š
     - å–å‡ºä¸‹ä¸€ä½æ•°æ® bit
     - é€šé“å€¼ = (é€šé“å€¼ & ~1) | bit
     - å†™å›åƒç´ 
   - è‹¥æ•°æ®å†™å…¥å®Œæˆåˆ™æå‰ç»“æŸéå†
8. è¾“å‡º
   - ä¿å­˜éšå†™å›¾åƒï¼ˆæ— æŸæ ¼å¼å¦‚ PNGï¼‰
   - è®°å½•æˆ–è¿”å›å†™å…¥ç»Ÿè®¡ä¿¡æ¯ï¼ˆä½¿ç”¨ä½æ•°ã€å¤´éƒ¨é•¿åº¦ç­‰ï¼‰
9. ç»“æŸ

- ç¤ºä¾‹ä¼ªä»£ç 

```
input: cover_image, payload
payload_bits = header(len(payload)) + to_bits(payload)
assert len(payload_bits) <= capacity(cover_image)
indices = prng_indices(key) or range(capacity)
for i, idx in enumerate(indices):
    if i == len(payload_bits): break
    channel_value = get_channel(cover_image, idx)
    set_channel(cover_image, idx, (channel_value & ~1) | payload_bits[i])
save(cover_image, 'stego.png')
```

<aside>
ğŸ’¡


ææ•ˆä¸å®‰å…¨å»ºè®®ï¼šä¼˜å…ˆä½¿ç”¨æ— æŸæ ¼å¼ï¼ˆPNGï¼‰ã€å¼€å¯åŠ å¯†ä¸éšæœºåµŒå…¥ï¼Œå¹¶åœ¨é«˜çº¹ç†åŒºåŸŸå¢åŠ å†™å…¥å¯†åº¦ä»¥é™ä½å¯æ£€æµ‹æ€§ã€‚

</aside>

## LSBéšå†™çš„ä¼˜ç¼ºç‚¹

### ä¼˜ç‚¹ï¼š

- å®ç°ç®€å•ï¼Œå®¹æ˜“ç†è§£
- å¯¹è½½ä½“åª’ä½“çš„è§†è§‰å½±å“å‡ ä¹ä¸å¯å¯Ÿè§‰
- å¯ä»¥éšè—ç›¸å¯¹è¾ƒå¤§é‡çš„æ•°æ®

### ç¼ºç‚¹ï¼š

- æŠ—æ”»å‡»èƒ½åŠ›è¾ƒå¼±ï¼Œå®¹æ˜“è¢«ç»Ÿè®¡åˆ†ææ£€æµ‹
- å¯¹å›¾åƒå‹ç¼©ç­‰æ“ä½œå¾ˆæ•æ„Ÿï¼Œå¯èƒ½å¯¼è‡´éšè—æ•°æ®ä¸¢å¤±
- åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¼•å…¥ç»Ÿè®¡å¼‚å¸¸

## Pythonå®ç°LSBéšå†™

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Pythonå’ŒPILï¼ˆPython Imaging Libraryï¼‰åº“å®ç°LSBéšå†™çš„ç¤ºä¾‹ï¼š

### 1. ä¿¡æ¯éšè—

```python
from PIL import Image

def text_to_bits(text):
    """å°†æ–‡æœ¬è½¬æ¢ä¸ºä½ä¸²"""
    bits = []
    for char in text:
        binary = bin(ord(char))[2:].zfill(8)  # å°†å­—ç¬¦è½¬æ¢ä¸º8ä½äºŒè¿›åˆ¶
        bits.extend([int(bit) for bit in binary])
    return bits

def hide_data(image_path, message, output_path):
    """åœ¨å›¾åƒä¸­éšè—ä¿¡æ¯"""
    # æ‰“å¼€å›¾åƒ
    img = Image.open(image_path)
    width, height = img.size
    img_data = list(img.getdata())
    
    # è½¬æ¢æ¶ˆæ¯ä¸ºä½
    binary_message = text_to_bits(message)
    
    # åœ¨æ¶ˆæ¯å‰æ·»åŠ é•¿åº¦ä¿¡æ¯ï¼ˆ32ä½ï¼‰
    message_length = len(binary_message)
    length_bits = [int(bit) for bit in bin(message_length)[2:].zfill(32)]
    
    binary_data = length_bits + binary_message
    
    if len(binary_data) > len(img_data) * 3:  # æ¯ä¸ªåƒç´ 3ä¸ªé€šé“
        raise ValueError("æ¶ˆæ¯å¤ªé•¿ï¼Œæ— æ³•åœ¨å›¾åƒä¸­éšè—")
    
    # ä¿®æ”¹åƒç´ çš„LSB
    new_img_data = []
    data_index = 0
    
    for pixel in img_data:
        # å¯¹RGBé€šé“åˆ†åˆ«å¤„ç†
        new_pixel = list(pixel)
        
        for i in range(3):  # RGBä¸‰ä¸ªé€šé“
            if data_index < len(binary_data):
                # ä¿®æ”¹æœ€ä½æœ‰æ•ˆä½
                new_pixel[i] = (new_pixel[i] & ~1) | binary_data[data_index]
                data_index += 1
            else:
                break
                
        new_img_data.append(tuple(new_pixel))
        
        if data_index >= len(binary_data):
            # æ‰€æœ‰æ•°æ®å·²åµŒå…¥ï¼Œæ·»åŠ å‰©ä½™åƒç´ 
            new_img_data.extend(img_data[len(new_img_data):])
            break
    
    # åˆ›å»ºæ–°å›¾åƒå¹¶ä¿å­˜
    new_img = Image.new(img.mode, img.size)
    new_img.putdata(new_img_data)
    new_img.save(output_path)
    
    return f"æ¶ˆæ¯å·²æˆåŠŸéšè—åœ¨å›¾åƒä¸­ã€‚æ€»å…±ä½¿ç”¨äº†{data_index}ä½ã€‚"

```

### 2. ä¿¡æ¯æå–

```python
def extract_data(image_path):
    """ä»å›¾åƒä¸­æå–éšè—çš„ä¿¡æ¯"""
    # æ‰“å¼€å›¾åƒ
    img = Image.open(image_path)
    img_data = list(img.getdata())
    
    # æå–æ‰€æœ‰LSB
    binary_data = []
    for pixel in img_data:
        for i in range(3):  # RGBä¸‰ä¸ªé€šé“
            binary_data.append(pixel[i] & 1)
            
    # æå–æ¶ˆæ¯é•¿åº¦
    length_bits = binary_data[:32]
    message_length = int(''.join(map(str, length_bits)), 2)
    
    # æå–æ¶ˆæ¯
    message_bits = binary_data[32:32 + message_length]
    
    # å°†ä½è½¬æ¢å›å­—ç¬¦
    message = ""
    for i in range(0, len(message_bits), 8):
        if i + 8 <= len(message_bits):
            byte = message_bits[i:i+8]
            char = chr(int(''.join(map(str, byte)), 2))
            message += char
    
    return message

```

### 3. ä½¿ç”¨ç¤ºä¾‹

```python
# éšè—ä¿¡æ¯
result = hide_data("original_image.png", "è¿™æ˜¯ä¸€æ¡éšè—æ¶ˆæ¯", "stego_image.png")
print(result)

# æå–ä¿¡æ¯
extracted_message = extract_data("stego_image.png")
print("æå–çš„æ¶ˆæ¯:", extracted_message)

```

## å®é™…åº”ç”¨ä¸å®‰å…¨è€ƒè™‘

LSBéšå†™æŠ€æœ¯åœ¨å®é™…åº”ç”¨ä¸­å¯ä»¥ç”¨äºï¼š

- æ•°å­—æ°´å°
- ç§˜å¯†é€šä¿¡
- ç‰ˆæƒä¿æŠ¤
- éšè”½å­˜å‚¨æ•æ„Ÿæ•°æ®

ä½†éœ€è¦æ³¨æ„ï¼š

- ç®€å•çš„LSBéšå†™å¯ä»¥è¢«éšå†™åˆ†æå·¥å…·æ£€æµ‹
- å¯¹å›¾åƒçš„ä»»ä½•å¤„ç†ï¼ˆå¦‚å‹ç¼©ã€è£å‰ªï¼‰éƒ½å¯èƒ½ç ´åéšè—çš„ä¿¡æ¯
- ä¸ºæé«˜å®‰å…¨æ€§ï¼Œéšè—çš„ä¿¡æ¯é€šå¸¸åº”è¯¥å…ˆåŠ å¯†

## é«˜çº§LSBéšå†™æŠ€æœ¯

ä¸ºäº†å¢å¼ºLSBéšå†™çš„å®‰å…¨æ€§å’Œé²æ£’æ€§ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹é«˜çº§æŠ€æœ¯ï¼š

- éšæœºåˆ†å¸ƒï¼šä¸æ˜¯æŒ‰é¡ºåºä¿®æ”¹LSBï¼Œè€Œæ˜¯ä½¿ç”¨ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ç¡®å®šä¿®æ”¹ä½ç½®
- å¤šä½éšå†™ï¼šä¸ä»…ä¿®æ”¹æœ€ä½ä½ï¼Œè¿˜å¯èƒ½ä¿®æ”¹æ¬¡ä½ä½ï¼Œä½†éœ€å¹³è¡¡å¯è§æ€§
- è‡ªé€‚åº”LSBï¼šæ ¹æ®å›¾åƒåŒºåŸŸçš„å¤æ‚åº¦åŠ¨æ€è°ƒæ•´éšå†™å®¹é‡
- ç»“åˆå…¶ä»–éšå†™æŠ€æœ¯ï¼šå¦‚DCTï¼ˆç¦»æ•£ä½™å¼¦å˜æ¢ï¼‰åŸŸéšå†™
